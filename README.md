# ğŸŒŸ 1. í”„ë¡œì íŠ¸ ê°œìš” ğŸŒŸ
- ì¼ë°˜ ì‚¬ìš©ìëŠ” ì¤‘ê³ ê±°ë˜ê°€ ê°€ëŠ¥

- ì‚¬ì—…ìëŠ” ì¸í„°ë„· ì‡¼í•‘ëª°ì„ ìš´ì˜ ê°€ëŠ¥.

- í”„ë¡ íŠ¸ì—”ë“œ ì—†ì´ ë°±ì—”ë“œë§Œ ê°œë°œ. (í¬ìŠ¤íŠ¸ë§¨ìœ¼ë¡œ í…ŒìŠ¤íŠ¸/ CORSëŠ” ê³ ë ¤X)



# ğŸ“‹ 2. ì£¼ìš” ê¸°ëŠ¥ ì„¤ëª… ğŸ“‹
### 1) ê¸°ë³¸ ê³¼ì œ
- ì‚¬ìš©ì ì¸ì¦ ë° ê¶Œí•œ ì²˜ë¦¬ (Spring Security + JWT)
    - ì‚¬ìš©ìëŠ” ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸ë¡œ íšŒì›ê°€ì…ì´ ê°€ëŠ¥. (**ë¹„í™œì„±** ì‚¬ìš©ì)
    - ë‹‰ë„¤ì„, ì´ë¦„, ì—°ë ¹ëŒ€, ì´ë©”ì¼, ì „í™”ë²ˆí˜¸ ì •ë³´ë¥¼ ì¶”ê°€í•´ì•¼ ì„œë¹„ìŠ¤ ì´ìš© ê°€ëŠ¥ (**ì¼ë°˜** ì‚¬ìš©ì)
    - ì¼ë°˜ ì‚¬ìš©ìëŠ” ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸ë¡œ ì‚¬ì—…ì ì‚¬ìš©ìë¡œ ì „í™˜ì‹ ì²­ ê°€ëŠ¥ (**ì‚¬ì—…ì** ì‚¬ìš©ì)
    - ê´€ë¦¬ìëŠ” ì‚¬ì—…ì ì „í™˜ ì‹ ì²­ ëª©ë¡ ì¡°íšŒ ë° ìˆ˜ë½/ê±°ì ˆ ê°€ëŠ¥ (**ê´€ë¦¬ì**)

- ì¤‘ê³ ê±°ë˜ ì¤‘ê°œí•˜ê¸°
    - ì¤‘ê³ ë¬¼í’ˆ ë“±ë¡/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
    - ë¹„í™œì„± ì‚¬ìš©ì ì œì™¸ ëˆ„êµ¬ë“ ì§€ ì—´ëŒ ê°€ëŠ¥
    - ë“±ë¡ëœ ì¤‘ê³ ë¬¼í’ˆì— ëŒ€í•˜ì—¬ êµ¬ë§¤ì œì•ˆ ë“±ë¡ ê°€ëŠ¥ (ì œì•ˆìì™€ ë¬¼í’ˆë“±ë¡ìëŠ” ì œì•ˆ í™•ì¸ ê°€ëŠ¥)
    - ë¬¼í’ˆë“±ë¡ìëŠ” êµ¬ë§¤ì œì•ˆ ìˆ˜ë½/ê±°ì ˆ ê°€ëŠ¥
    - ì œì•ˆë“±ë¡ìëŠ” ì œì•ˆ ìˆ˜ë½ì‹œ êµ¬ë§¤í™•ì •/êµ¬ë§¤ì·¨ì†Œ ê°€ëŠ¥
- ì‡¼í•‘ëª° ìš´ì˜í•˜ê¸°
    - ì‚¬ì—…ì ì‚¬ìš©ìë¡œ ì „í™˜ë˜ë©´ ì‡¼í•‘ëª° ìƒì„±
    - ì‡¼í•‘ëª° í•„ìˆ˜ì •ë³´ë¥¼ ê°€ì§€ê³  ì‡¼í•‘ëª° ê°œì„¤ì‹ ì²­/íì‡„ìš”ì²­ ê°€ëŠ¥
    - ê´€ë¦¬ìëŠ” ê°œì„¤ì‹ ì²­ ëª©ë¡ ì¡°íšŒ ë° ìˆ˜ë½/ê±°ì ˆ ê°€ëŠ¥
    - ì‡¼í•‘ëª°ì— ìƒí’ˆ ë“±ë¡/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
    - ë¹„í™œì„± ì‚¬ìš©ì ì œì™¸ ì‡¼í•‘ëª° ì¡°íšŒ ë° ìƒí’ˆ ê²€ìƒ‰ ê°€ëŠ¥
    - ë¹„í™œì„± ì‚¬ìš©ì ì œì™¸ ì‡¼í•‘ëª° ìƒí’ˆ êµ¬ë§¤ ê°€ëŠ¥


### 2) ì¶”ê°€ ê³¼ì œ (ìµœì†Œ 1ê°œ êµ¬í˜„)
- ê²°ì œ ì‹œìŠ¤í…œ (Toss payments)
    - ì‡¼í•‘ëª° ìƒí’ˆ êµ¬ë§¤ì‹œ ê²°ì œ ì§„í–‰ ê°€ëŠ¥
    - êµ¬ë§¤ ìš”ì²­ ì·¨ì†Œì‹œ ê²°ì œ ê¸ˆì•¡ í™˜ë¶ˆ ê°€ëŠ¥
- ì‚¬ìš©ì ìœ„ì¹˜ê¸°ë°˜ ê¸°ëŠ¥ (NCP maps)
- ì•Œë¦¼ ê¸°ëŠ¥ ì¶”ê°€í•˜ê¸° (Email - Jakarta Mail)
- ì•Œë¦¼ ê¸°ëŠ¥ ì¶”ê°€í•˜ê¸° (NCP SENS)
- ì‚¬ìš©ì ìë™ ë¡œê·¸ì¸ ë°©ì§€ (NCP Capcha)


# ğŸš© 3. ë‚˜ì˜ ëª©í‘œ ğŸš©
**ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ ë†“ì¹˜ê³  ì‹¶ì§€ ì•Šì€ ê²ƒ!!**

- ì´ì œê¹Œì§€ ë°°ìš´ ê¸°ìˆ ë“¤ì„ ëª…í™•íˆ **ì´í•´**í•˜ë©´ì„œ ì½”ë“œë¥¼ ì‘ì„±í•  ê²ƒ

- ì–´ë– í•œ ê¸°ìˆ ì„ ì„ íƒí•  ë•Œ ê·¸ **ì´ìœ **ì— ëŒ€í•´ì„œ ìƒê°í•˜ê³ , ì–´ë–¤ ì´ìœ ì—ì„œ ì„ íƒí–ˆëŠ”ì§€ë¥¼ ì •ë¦¬í•  ê²ƒ

- **ì œì•½ì‚¬í•­**ì„ ë°˜ë“œì‹œ ì§€í‚¬ ê²ƒ. ê¼¼ìˆ˜ë¶€ë¦¬ì§€ ì•Šê¸°

- ìœ ì§€ë³´ìˆ˜, ì‘ì—… íš¨ìœ¨ì„ ê³ ë ¤í•˜ë©° **í™•ì¥ì„±**ê³¼ **ìœ ì—°ì„±**ì„ ê°€ì§„ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ ê²ƒ

- **ì˜¤ë¥˜**ë¥¼ ë§ì´ ê²ªì„ ê²ƒ. ê²ªì—ˆë˜ ì˜¤ë¥˜ë“¤ì„ ë°˜ë“œì‹œ ì •ë¦¬í•´ë‘˜ ê²ƒ

- ë¹ ë¥´ê³  ì‹ ì†í•˜ê²Œ ë§Œë“¤ê¸°ë³´ë‹¤ ì—¬ìœ ë¡­ê³  **ì°¨ê·¼ì°¨ê·¼** í•˜ë‚˜ì”© ì™„ì„±í•´ë‚˜ê°ˆ ê²ƒ


# âœ… 4. Project âœ…
<details> 
<summary><strong>SKILL</strong></summary>
<div markdown="1">       

**[Front-end]**  
<img src="https://img.shields.io/badge/HTML5-E34F26?style=for-the-badge&logo=html5&logoColor=white" />


**[Back-end]**   
<img src="https://img.shields.io/badge/java%2017-007396?style=for-the-badge&logo=java&logoColor=white">
<img src="https://img.shields.io/badge/MySQL%208.0.2-4479A1?style=for-the-badge&logo=mysql&logoColor=white">
<img src="https://img.shields.io/badge/spring%20boot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white">
<img src="https://img.shields.io/badge/spring%20security-6DB33F?style=for-the-badge&logo=springsecurity&logoColor=white">
<img src="https://img.shields.io/badge/apache%20tomcat-F8DC75?style=for-the-badge&logo=apachetomcat&logoColor=white">
<img src="https://img.shields.io/badge/JPA-005F0F?style=for-the-badge&logo=jpa&logoColor=white">
![Hibernate](https://img.shields.io/badge/Hibernate-59666C?style=for-the-badge&logo=Hibernate&logoColor=white)
![JWT](https://img.shields.io/badge/JWT-black?style=for-the-badge&logo=JSON%20web%20tokens)
<img src="https://img.shields.io/badge/AWS%20S3-569A31?style=for-the-badge&logo=amazons3&logoColor=white">


**[Tool & Environment]**  
<img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
<img src="https://img.shields.io/badge/IntelliJ%20IDEA-CB5B8D?style=for-the-badge&logo=intellijidea&logoColor=white">
<img src="https://img.shields.io/badge/figma-F24E1E?style=for-the-badge&logo=figma&logoColor=white">
<img src="https://img.shields.io/badge/Postman-FF6C37?style=for-the-badge&logo=postman&logoColor=white">


</div>
</details>

<details>
<summary><strong>API</strong></summary>
<div markdown="1">       

- **JWT(Jason Web Token)**: íšŒì› ë¡œê·¸ì¸ ê¸°ëŠ¥ í™œìš© <img src="https://img.shields.io/badge/JWT-black?style=for-the-badge&logo=JSON%20web%20tokens&logoColor=white">
- **Toss Payments**: ì‡¼í•‘ëª° ìƒí’ˆ ê²°ì œ ê¸°ëŠ¥ êµ¬í˜„ì‹œ í™œìš© <img align="center" src="https://img.shields.io/badge/Toss Payments-0043FE?style=for-the-badge&logo=&logoColor=white" />
- **AWS S3**: ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš© <img src="https://img.shields.io/badge/AWS%20S3-569A31?style=for-the-badge&logo=amazons3&logoColor=white">

</div>
</details>

<details>


<summary><strong>ERD</strong></summary>
<div markdown="1">       

![img.png](erddiagram.png)

</div>
</details>

# ğŸ¯ í”„ë¡œì íŠ¸ ì‹¤í–‰/í…ŒìŠ¤íŠ¸ ë°©ë²• ğŸ¯
### ì‹¤í–‰
1. git clone
2. ìµœì´ˆ ì‹¤í–‰ì‹œ application.yamlì„ ìˆ˜ì •í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.
- aws cloud access-keyì™€ secret-keyë¥¼ ì…ë ¥í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.


<details>

- access-key : AKIA2D2KRCMYUNHH5AN5
- secret-key : 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
- toss.secret : test_sk_Z1aOwX7K8mvknRwm1Kaq3yQxzvNP
</details>

3. ìµœì´ˆ ì‹¤í–‰ í›„ jpa.hibernate.ddl-auto: updateë¡œ ë°”ê¿”ì£¼ë©´ ëœë‹¤.
4. í…ŒìŠ¤íŠ¸ì‹œ postman íŒŒì¼ì„ importí•˜ì—¬ ì‹¤í–‰í•˜ë„ë¡ í•œë‹¤.

### í…ŒìŠ¤íŠ¸
1) íšŒì›ê°€ì…í•˜ê¸°
2) ë¡œê·¸ì¸í•˜ê¸°
3) ì´í›„ ë§¤ ìš”ì²­ë§ˆë‹¤ í† í°ì„ ë³µì‚¬í•˜ì—¬ Auth - Bearer Tokenì— ë¶™ì—¬ë„£ê¸° 
- í† ìŠ¤ í…ŒìŠ¤íŠ¸ì‹œ : 

#  ğŸš€ 5. ì°¸ì—¬ì (24.02.22 ~ 24.03.05)

|<img src="https://github.com/simidot/Mission_youshin/assets/114278754/424c1792-bdc5-4843-8c41-b8ad9711cae2" width="160" height="160"/><br/>BE ê°•ìœ ì‹  <a href="https://github.com/simidot">GitHub</a>|
|:---:|

# ğŸ–¥ï¸ 6. êµ¬í˜„ ê³¼ì • ë° ì •ë¦¬ ğŸ–¥ï¸
### 1) ê¸°ë³¸ì ì¸ CYCLE ì •ë¦¬
![img.png](lifecycle.png)

### 2) ì‡¼í•‘ëª° ê°œì„¤/íì‡„ ê²½ìš°ì˜ ìˆ˜ ì •ë¦¬
![running_status.png](running_status.png)

### 3) Spring Security + JWT êµ¬í˜„ë°©ë²•
![img_1.png](img_1.png)
#### [ì •ë¦¬ê¸€ ë§í¬](https://hehesim.tistory.com/216)


# ğŸš€ 7. ì§„í–‰ ì¤‘ ë°œìƒí•œ ì–´ë ¤ì›€ ë° ê³ ë¯¼ê±°ë¦¬ ğŸš€

<details>
<summary><strong>1. UserDetailsManagerì™€ UserEntity</strong></summary>

<div markdown="1"> 

- UserDetailsManagerì˜ êµ¬í˜„ì²´ì¸ CustomUserDetailsManagerë¥¼ ë§Œë“¤ì–´ì£¼ì—ˆê³ , ì—¬ê¸°ì„œ UserEntityRepositoryì™€ì˜ ì—°ê²°ì ì´ ë˜ì—ˆë‹¤.

- ê³ ë¯¼ì€ UserDetailsì˜ êµ¬í˜„ì²´ì¸ CustomUserDetails ìì²´ë¥¼ UserEntity ì·¨ê¸‰ì„ í•˜ì—¬ì•¼ í•  ê²ƒì¸ì§€, CustomUserDetailsëŠ” UserEntityì™€ëŠ” ë‹¤ë¥¸ ê²ƒìœ¼ë¡œ ì·¨ê¸‰í•´ì•¼í• ì§€ ì˜ ëª¨ë¥´ê² ë‹¤.

---

- ì¼ë‹¨ ë‚´ê°€ êµ¬í˜„í•œ ë°©ì‹ì€ CustomUserDetails, CustomUserDetailsëŠ” Spring Securityì—ì„œ ì œê³µë˜ëŠ” ë¶€ë¶„ì´ë¯€ë¡œ ì´ëŠ” ìœ ì €ì˜ ì¸ì¦ê³¼ ê´€ë ¨í•œ ë¶€ë¶„ì„ ë‹¤ë£¨ì–´ì•¼ í•˜ê³ ,
- UserEntityëŠ” ì¸ì¦ë³´ë‹¤ëŠ” ì‹¤ì œ DBì— ì €ì¥ë˜ëŠ” ìœ ì € í…Œì´ë¸”ì— ëŒ€í•œ ê²ƒë“¤ì„ ë‹¤ë£¨ì–´ì•¼ í•œë‹¤ê³  ìƒê°í•˜ì—¬ ê·¸ë ‡ê²Œ ë‚˜ëˆ„ì–´ êµ¬í˜„í–ˆë‹¤.

- ìš”ë ‡ê²Œ ë‘ê°€ì§€ë¡œ ì„œë¹„ìŠ¤ë¥¼ **ë‚˜ëˆ„ì–´ êµ¬í˜„**í•´ë³´ì•˜ë‹¤.
  ![img.png](img.png)
</div>
</details>


<details>
<summary><strong>2. ê´€ë¦¬ì ê³„ì • ìƒì„±</strong></summary>

<div markdown="1"> 

- ê´€ë¦¬ì ê³„ì •ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±ì‹œ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ì–´ ì´í›„ íšŒì›ê°€ì… ë°©ì‹ìœ¼ë¡œëŠ” ê´€ë¦¬ì ê³„ì •ì„ ë§Œë“¤ ìˆ˜ ì—†ë„ë¡ êµ¬í˜„í–ˆë‹¤. ê´€ë¦¬ì SQLë¬¸ì„ **data.sql**ë¡œ ë„£ì–´ì„œ êµ¬í˜„í•˜ë ¤ê³  í•˜ì˜€ë‹¤.
- ì´ë•Œ data.sqlë¬¸ì„ ë‚´ì¥ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì•„ë‹Œ ì™¸ë¶€ ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” yamlì—ì„œ script íŒŒì¼ì„ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •ì„ ì ìš©í•´ì•¼ í•œë‹¤.
```yaml
spring.sql.init.mode: always
```

- hibernate.ddl-auto ì˜µì…˜ê³¼ í•¨ê»˜ data.sql ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•  ë•Œì— í•„ìš”í•œ ì˜µì…˜ì´ ë˜ ì¡´ì¬í•œë‹¤.
```yaml
spring.jpa.defer-datasource-initialization: true
```

- ì´ ì„¤ì •ì„ í™œìš©í•˜ë©´ ddl-auto ì˜µì…˜ì— ëŒ€í•œ ì„¤ì •ì´ ë¨¼ì € ì‹¤í–‰ë˜ê³ , ì´í›„ scriptê°€ ì‹¤í–‰ë˜ì–´ data.sqlì´ ì ìš©ë˜ê²Œ ëœë‹¤.
```yaml
spring:
  sql:
    init:
      mode: always
  jpa:
    hibernate:
      ddl-auto: create
    defer-datasource-initialization: true
```

- ê·¸ëŸ¬ë‚˜, ë‚˜ëŠ” ì²˜ìŒì— ë˜ë˜ sql scriptê°€ í”„ë¡œì íŠ¸ ì¤‘ê°„ì— ê°‘ìê¸° ì‹¤í–‰ì´ ë˜ì§€ ì•Šì•˜ë‹¤...
  ![img_2.png](img_2.png)

---
ê²°êµ­ ì„¸íŒ…ì„ ì¡°ê¸ˆ ë°”ê¿”ì„œ **import.sql**ë¡œ **hibernate** ë‚´ì—ì„œ ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ë˜ë„ë¡ ë³€ê²½í–ˆë”ë‹ˆ ë˜ê¸´ ëë‹¤.
```yaml
spring:
  sql:
    init:
      data-locations: classpath:import.sql
      mode: always
  jpa:
    hibernate:
      ddl-auto: create
    defer-datasource-initialization: true
    show-sql: true
```
- ì°¸ê³ ë¡œ, ê´€ë¦¬ì sqlì„ ë„£ìœ¼ë©´ ë¡œê·¸ì¸ì‹œ ë¹„ë°€ë²ˆí˜¸ê°€ **ë³µí˜¸í™”**ë˜ë©´ì„œ ì¼ì¹˜ë¥¼ í™•ì¸í•˜ê¸° ë•Œë¬¸ì—, ì´ë¥¼ **ì•”í˜¸í™”ëœ ì±„**ë¡œ ë„£ì–´ì£¼ì–´ì•¼ í•œë‹¤. ê·¸ë˜ì„œ ë‚˜ëŠ” Bcryptë¡œ ì•”í˜¸í™”í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„£ì–´ì£¼ì—ˆë‹¤.
```sql
#  import.sql
# ì´ˆê¸° admin ê³„ì • ìƒì„±
INSERT INTO user_entity (account_id, password, authority)
VALUES ('admin', '$2a$10$hithVJ9E/VPOzKwGfn9kQu9c0QcBfAWnaFNFWh0gohj03Ij05pm9.', 'ROLE_ADMIN');
```
** ì´ê²ƒê³¼ ê´€ë ¨í•´ì„œëŠ” ë‹¤ì‹œ í™•ì¸í•´ë´ì•¼í•  ê²ƒ ê°™ë‹¤. ê·¼ë³¸ì ì¸ í•´ê²°ì±…ì´ ì•„ë‹Œ ëŠë‚Œì´ë‹¤.
</div>
</details>


<details>
<summary><strong>3. ì¸ì¦ê³¼ í† í°</strong></summary>

<div markdown="1"> 
- ì‚¬ìš©ì ì¸ì¦ ì²˜ë¦¬ë¥¼ í–ˆëŠ”ë°, USER_ROLEì— ë”°ë¼ì„œ í•„í„°ë§ì€ ë˜ëŠ”ë°, 
í•´ë‹¹ ë¡œê·¸ì¸ ì•„ì´ë”” ì£¼ì¸ì´ë¼ëŠ” ê²ƒì„ ì¸ì¦í•˜ê³ ë‚˜ì„œ í•´ë‹¹ ê¸°ëŠ¥ì— ëŒ€í•œ ì ‘ê·¼ì´ ì œí•œë˜ì–´ì•¼ í•˜ëŠ”ë°, ì•ˆë˜ê³  ìˆë‹¤.

ex) ë‚˜ëŠ” 123ì¸ë°, 234ì˜ ì •ë³´ë„ ìˆ˜ì •ì´ ë˜ëŠ” ë¬¸ì œ. ì¦‰, ê³„ì • ì£¼ì¸ë§Œì´ ì •ë³´ìˆ˜ì •ì´ ê°€ëŠ¥í•œë°, ë‹¤ë¥¸ ê³„ì • ì£¼ì¸ë„ ì •ë³´ìˆ˜ì •ì— ëŒ€í•œ ì ‘ê·¼ì´ ëœë‹¤ëŠ” ê²ƒ.

---
=> ê¹¨ë‹¬ìŒ!

- ì´ë¥¼ ìœ„í•´ **JWT í† í°**ì„ í™œìš©í•˜ëŠ” ê±°êµ¬ë‚˜! ìš”ì²­ë§ˆë‹¤ headerì— JWT í† í°ì´ í¬í•¨ë˜ì–´ ìˆê³ , ì–´ë–¤ ê¸°ëŠ¥ì—ì„œëŠ” ì¸ì¦ì— ë”ë¶ˆì–´ í•´ë‹¹ ê³„ì •ì˜ ì£¼ì¸ì´ë¼ëŠ” ê²ƒì„ ì•Œì•„ì•¼ í•œë‹¤. ê·¸ëŸ¬ë¯€ë¡œ **í™•ì¸í•˜ëŠ” ê³¼ì •**ì„ í•´ë‹¹ ë©”ì„œë“œì— êµ¬í˜„í•´ì•¼ í•˜ëŠ” ê²ƒ.

ex) ì‚¬ì—…ì ê³„ì • ì „í™˜ ì‹ ì²­ì‹œ í•´ë‹¹ ë¡œê·¸ì¸í•œ ì•„ì´ë””ì™€ ì‹ ì²­í•˜ëŠ” ìœ ì €ê°€ ê°™ì€ì§€ í™•ì¸í•˜ëŠ” ê³¼ì •. manager.checkIdIsEqual() ì—ì„œ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤. ë§Œì•½ ì¼ì¹˜í•˜ì§€ ì•Šì„ì‹œì—ëŠ” ResponseStatusExceptionì´ ë°œìƒí•œë‹¤.

```java
// UserService class
	// ì‚¬ì—…ìê³„ì • ì „í™˜ ì‹ ì²­
    @Transactional
    public BAResponse registerBA (String accountId, BARequest dto) {
        UserEntity foundUser = optional.getFoundUser(accountId);
        // ë¡œê·¸ì¸í•œ ì•„ì´ë””ì™€ ì´ ìœ ì €ê°€ ê°™ì€ì§€ í™•ì¸
        manager.checkIdIsEqual(foundUser.getAccountId());

        // ë“±ë¡ìš”ì²­ update
        foundUser.setBusinessNumber(dto.getBusinessNumber());
        foundUser.setBusinessIsAllowed(false);
        foundUser = userRepository.save(foundUser);

        return BAResponse.fromEntity(foundUser);
    }
    
// CustomUserDetailsManager class
    // ë¡œê·¸ì¸í•œ ì•„ì´ë””ì™€ í•´ë‹¹ ì•„ì´ë””ê°€ ê°™ì€ì§€ í™•ì¸í•˜ëŠ” ë©”ì„œë“œ
    public void checkIdIsEqual(String accountId) {
        String loginId = facade.getAuth().getName(); //í˜„ì¬ ì¸ì¦ì •ë³´ì˜ id name
        // ë‹¤ë¥´ë©´ ì˜ˆì™¸ì²˜ë¦¬
        if (!accountId.equals(loginId)) {
            throw new ResponseStatusException(HttpStatus.FORBIDDEN);
        }
        // ê°™ìœ¼ë©´ ê³„ì† ì´ì–´ì„œ ê°
    }
```


</div>
</details>
<details>
<summary><strong>4. í´ë˜ìŠ¤ìºìŠ¤íŒ… ì˜¤ë¥˜</strong></summary>

<div markdown="1"> 


![img_3.png](img_3.png)

```java
    @Override
    public CustomUserDetails loadUserByUsername(String userId) throws UsernameNotFoundException {
        //repoì—ì„œ userIdë¡œ ì°¾ì•„ì˜¤ê¸°
        Optional<UserEntity> optionalUser = userRepository.findByAccountId(userId);
        if (optionalUser.isEmpty()) {
            log.info("loadUserByUsername : not found");
            throw new ResponseStatusException(HttpStatus.NOT_FOUND);
        }

        UserEntity userEntity = optionalUser.get();
        //ë¦¬í„´ì„ UserDetails í˜•íƒœë¡œ í•œë‹¤
        CustomUserDetails userDetails = (CustomUserDetails) User.withUsername(userEntity.getAccountId())
                .password(userEntity.getPassword())
                .authorities(userEntity.getAuthority())
                .build();
        return userDetails;
    }
```
- ì²˜ìŒì—ëŠ” ì´ë ‡ê²Œ ì‹œë„ë¥¼ í–ˆë‹¤. ë¬´ì¡°ê±´ User.withUsername()....build()ì´ë ‡ê²Œ ìœ ì €ë¥¼ ë¹Œë“œí•´ì•¼í•˜ëŠ”ì¤„ ì•Œì•˜ë‹¤.
- ê·¸ëŸ¬ë‚˜, ì´ë ‡ê²Œ Userë¡œ ìƒì„±í•˜ì—¬ CustomUserDetailsë¡œ **í´ë˜ìŠ¤ ìºìŠ¤íŒ…ì´ ë¶ˆê°€**í–ˆë‹¤.
- ì™œëƒí•˜ë©´ Userí´ë˜ìŠ¤ëŠ” Spring Securityì—ì„œ UserDetailsë¥¼ êµ¬í˜„í•´ë†“ì€ **êµ¬í˜„ì²´** ì¤‘ í•˜ë‚˜ê³ , ì´ë¥¼ í™œìš©í•´ í¸í•˜ê²Œ ë¹Œë”ë¡œ ê°ì²´ ìƒì„±ê°€ëŠ¥í•˜ê²Œ í•´ë†“ì€ ê²ƒì´ë‹¤.
- ì¦‰, User, CustomUserDetails ë‘˜ ë‹¤ êµ¬í˜„ì²´ì´ê¸° ë•Œë¬¸ì— í´ë˜ìŠ¤ìºìŠ¤íŒ…ì´ ë¶ˆê°€í•˜ë‹¤.

---

- ë‚˜ëŠ” CustomUserDetailsë¥¼ ë§Œë“¤ì–´ë‘ì—ˆìœ¼ë‹ˆ, ì´ë¡œ ë¦¬í„´í•˜ê¸° ìœ„í•´ì„œëŠ” ê·¸ëƒ¥ **CustomUserDetails** ë¹Œë”íŒ¨í„´ìœ¼ë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ë©´ ëœë‹¤.
```java
    @Override
    public CustomUserDetails loadUserByUsername(String userId) throws UsernameNotFoundException {
        //repoì—ì„œ userIdë¡œ ì°¾ì•„ì˜¤ê¸°
        Optional<UserEntity> optionalUser = userRepository.findByAccountId(userId);
        if (optionalUser.isEmpty()) {
            log.info("loadUserByUsername : not found");
            throw new ResponseStatusException(HttpStatus.NOT_FOUND);
        }

        UserEntity userEntity = optionalUser.get();
        //ë¦¬í„´ì„ UserDetails í˜•íƒœë¡œ í•œë‹¤
        CustomUserDetails userDetails = CustomUserDetails.builder()
                .userId(userEntity.getAccountId())
                .password(userEntity.getPassword())
                .authorities(userEntity.getAuthority())
                .build();
        return userDetails;
    }
```

</div>
</details>


<details>
<summary><strong>5. Stream API ì‚¬ìš©ê³¼ ì¡°ê±´ ì„¤ì • : if else ë¬¸ + isEmpty</strong></summary>

<div markdown="1">

- ë¬¼í’ˆ êµ¬ë§¤ ì œì•ˆì„ ì¡°íšŒí•  ë•Œ ì¡°ê±´ì´ ìˆì—ˆë‹¤.

    1) ë¬¼í’ˆ ë“±ë¡í•œ ì‚¬ìš©ìëŠ” ë¬¼í’ˆì— ëŒ€í•œ ì œì•ˆì„ ëª¨ë‘ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.
    2) ë¬¼í’ˆì— ëŒ€í•´ ì œì•ˆì„ ë“±ë¡í•œ ì‚¬ìš©ìëŠ” ë³¸ì¸ì˜ ì œì•ˆë§Œ í™•ì¸ì´ ê°€ëŠ¥í•˜ë‹¤.
    3) ë“±ë¡ìì™€ ì œì•ˆìê°€ ì•„ë‹Œ ì‚¬ìš©ìëŠ” ì¡°íšŒê°€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.

ì´ëŸ¬í•œ ì„¸ê°€ì§€ ì¡°ê±´ì„ í‘œí˜„í•˜ê¸°ê°€ ì–´ë µê³  ë³µì¡í–ˆë‹¤. ë˜ ì´ë¥¼ Stream APIë¥¼ ì‚¬ìš©í•˜ì—¬ í‘œí˜„í•´ì£¼ê³  ì‹¶ì—ˆë‹¤.

1) ë¡œê·¸ì¸ ì‚¬ìš©ìê°€ í•´ë‹¹ ë¬¼í’ˆì˜ **Sellerì¸ì§€** í™•ì¸ => Sellerì´ë©´ í•´ë‹¹ ë¬¼í’ˆì— ëŒ€í•œ ì œì•ˆ ëª¨ë‘ í™•ì¸ ê°€ëŠ¥

2) ë¡œê·¸ì¸ ì‚¬ìš©ìê°€ í•´ë‹¹ ë¬¼í’ˆì˜ Sellerê°€ ì•„ë‹ˆë¼ë©´, => í•´ë‹¹ ë¬¼í’ˆì˜ ì „ì²´ ì œì•ˆì—ì„œ ë¡œê·¸ì¸ ì‚¬ìš©ìê°€ **Buyerì¸ì§€** í™•ì¸í•˜ê³  ë¦¬ìŠ¤íŠ¸ë¡œ ì¶”ì¶œ

3) ê·¸ ë¦¬ìŠ¤íŠ¸ê°€ **ë¹„ì–´ìˆë‹¤ë©´** í•´ë‹¹ ë¬¼í’ˆì˜ Sellerë„, Buyerë„ ì•„ë‹ˆê¸° ë•Œë¬¸ì— -> í•´ë‹¹ ë¬¼í’ˆì˜ ì œì•ˆì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì´ ì—†ë‹¤.
4) ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´ ì œì•ˆ ë“±ë¡í•œ ì‚¬ìš©ìì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì‚¬ìš©ìì˜ ì œì•ˆë§Œ í™•ì¸ ê°€ëŠ¥.

```java
    // ë¬¼í’ˆ êµ¬ë§¤ ì œì•ˆ ì¡°íšŒ
    // ë¬¼í’ˆ ë“±ë¡í•œ ì‚¬ìš©ìì™€ ì œì•ˆë“±ë¡ ì‚¬ìš©ìë§Œ ì¡°íšŒ ê°€ëŠ¥
    public List<SuggestionResponse> readSuggestions(Long usedGoodsId) {
        UsedGoods foundGoods = optional.getUsedGoods(usedGoodsId);
        UserEntity loginUser = manager.loadUserFromAuth();

        // ë¬¼í’ˆë“±ë¡ìëŠ” ëª¨ë“  ì œì•ˆ í™•ì¸ ê°€ëŠ¥
        if (loginUser.equals(foundGoods.getSeller())) {
            log.info("ì¤‘ê³ ë¬¼í’ˆ ë“±ë¡ìê°€ ì¡°íšŒí•©ë‹ˆë‹¤");
            return suggestionRepo.findByUsedGoods(foundGoods).stream()
                    .map(SuggestionResponse::fromEntity)
                    .collect(Collectors.toList());
        } // ì œì•ˆë“±ë¡ìëŠ” ìì‹ ì˜ ì œì•ˆë§Œ í™•ì¸ ê°€ëŠ¥
        else {
            List<Suggestion> suggestions = foundGoods.getSuggestionList()
                    .stream()
                    .filter(suggestion -> loginUser.equals(suggestion.getBuyer()))
                    .peek(suggestion -> log.info("ì¤‘ê³ ë¬¼í’ˆ êµ¬ë§¤ ì œì•ˆìê°€ ì¡°íšŒí•©ë‹ˆë‹¤."))
                    .collect(Collectors.toList());
            // ë§Œì•½ ìì‹ ì˜ ì œì•ˆì´ ì—†ë‹¤ë©´ suggestionListê°€ ë¹„ì–´ìˆì„ ê²ƒ.
            if (suggestions.isEmpty()) {
                throw new ResponseStatusException(HttpStatus.FORBIDDEN, "ì œì•ˆì¡°íšŒ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
            }
            return suggestions.stream()
                    .map(SuggestionResponse::fromEntity)
                    .peek(response -> log.info("SuggestionList:: "+response))
                    .collect(Collectors.toList());
        }
    }
```
</div>
</details>

<details>
<summary><strong>6. Forbidden ì—ëŸ¬</strong></summary>

<div markdown="1"> 

- ë¶„ëª… ResponseExceptionì— ëŒ€í•œ ë‹¤ì–‘í•œ ì„¤ì •ì„ í•´ë‘ì—ˆëŠ”ë°, ìš”ì²­ì— ëŒ€í•œ ì—ëŸ¬ê°€ ë¬´ì¡°ê±´ **403 Forbidden**ë§Œ ë‚˜íƒ€ë‚¬ë‹¤. ê·¸ë˜ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ì–´ë–¤ ì´ìœ ì¸ì§€ ì°¾ê¸°ê°€ ë„ˆë¬´ ì–´ë ¤ì› ë‹¤. not foundì¸ì§€, bad requestì¸ì§€ ë“±ë“± ì–´ë–¤ ì—ëŸ¬ì¸ì§€ë¥¼ í™•ì¸í•´ì•¼ ì‰½ê²Œ í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ”ë°.
  ![img_4.png](img_4.png)

---
=> ì•Œê³ ë³´ë‹ˆ SecurityFilterChainì—ì„œ requestì— ëŒ€í•œ ì„¤ì • ë•Œë¬¸ì´ì—ˆë‹¤.
- ë§¨ ë§ˆì§€ë§‰ì˜ anyRequest().authenticated() ì„¤ì •ìœ¼ë¡œ ì¸í•´ ì–´ë–¤ ìš”ì²­ì´ë“  ì¸ì¦ì´ ë˜ì–´ì•¼ í•œë‹¤ëŠ” ì„¤ì •ì´ ë˜ì–´ìˆëŠ”ë°, ì—ëŸ¬ê°€ ìƒê²¼ì„ ë•Œì—ëŠ” /errorë¡œ ìš”ì²­ì´ ê°€ê¸° ë•Œë¬¸ì— ì´ë•Œì—ë„ ì¸ì¦ ì •ë³´ê°€ í•„ìš”í•œ ì…ˆì´ë‹¤.

ê·¸ëŸ¬ë¯€ë¡œ ì—ëŸ¬ í˜ì´ì§€ì— ëŒ€í•´ì„œëŠ” ëª¨ë“  ì‚¬ìš©ìê°€ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ë°”ê¾¸ì—ˆë‹¤.
> .requestMatcher("/error").permitAll()ì„ ë§¨ìœ„ì— ì¶”ê°€í•´ì£¼ì—ˆë‹¤.

```java
@Configuration
@RequiredArgsConstructor
public class WebSecurityConfig {
    private final JwtTokenUtils jwtTokenUtils;
    private final UserDetailsManager manager;

    @Bean
    public SecurityFilterChain securityFilterChain(
            HttpSecurity httpSecurity
    ) throws Exception {
        httpSecurity
                //csrf ë³´ì•ˆ í•´ì œ
                .csrf(AbstractHttpConfigurer::disable)
                .sessionManagement(session ->
                        session.sessionCreationPolicy(SessionCreationPolicy.STATELESS))
                .addFilterBefore(new JwtTokenFilter(jwtTokenUtils, manager), AuthorizationFilter.class)
                //urlì— ë”°ë¥¸ ìš”ì²­ ì¸ê°€
                .authorizeHttpRequests(
                        auth -> //ë¡œê·¸ì¸, íšŒì›ê°€ì…ì€ ìµëª…ì‚¬ìš©ìë§Œ ìš”ì²­ ê°€ëŠ¥
                                auth
                                        .requestMatchers("/error").permitAll()
                                        // ê´€ë¦¬ì í˜ì´ì§€ëŠ” ê´€ë¦¬ìë§Œ ê°€ëŠ¥
                                        .requestMatchers("/admin/**")
                                        .hasAnyRole("ADMIN")
                                        // ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì…ì€ ìµëª… ì‚¬ìš©ìë§Œ ê°€ëŠ¥
                                        .requestMatchers("/users/login", "/users/register")
                                        .anonymous()
                                        // ì¶”ê°€ì •ë³´ ì…ë ¥ì€ inactiveë§Œ ê°€ëŠ¥
                                        .requestMatchers("/users/{accountId}/additional-info")
                                        .hasAnyRole("INACTIVE")
                                        // ì¤‘ê³ ê±°ë˜, ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì • ì‹ ì²­/í™•ì¸, ì‡¼í•‘ëª° ì„œë¹„ìŠ¤ ì´ìš© active, businessë§Œ ê°€ëŠ¥
                                        .requestMatchers("/users/**", "/used-goods/**")
                                        .hasAnyRole("ACTIVE", "BUSINESS")
                                        // ì‡¼í•‘ëª° ìš´ì˜ ì„œë¹„ìŠ¤ëŠ” businessíšŒì›ë§Œ ê°€ëŠ¥
                                        .requestMatchers("/shopping-malls/**")
                                        .hasAnyRole("ACTIVE", "BUSINESS", "ADMIN")
                                        .anyRequest().authenticated()
                )
        ;
        return httpSecurity.build();
    }
}
```

![img_5.png](img_5.png)
- ê·¸ë¬ë”ë‹ˆ ì •ìƒì ìœ¼ë¡œ ì˜¤ë¥˜ í™”ë©´ì´ ë‚˜ì™”ë‹¤. í•´ê²° ì™„ë£Œ!
</div>
</details>


<details>
<summary><strong>7. AWS S3ì— ì—…ë¡œë“œ : ë§í¬ë¡œ ì´ë™ì‹œ ë‹¤ìš´ë¡œë“œë˜ëŠ” ë¬¸ì œ</strong></summary>

<div markdown="1"> 

- ì‚¬ì§„ ì—…ë¡œë“œì— ëŒ€í•œ êµ¬í˜„ì„ ì§„í–‰ì¤‘ì— ì‚¬ì§„ì„ AWS S3 ìŠ¤í† ë¦¬ì§€ì— ì—…ë¡œë“œí•˜ê³ , ì—…ë¡œë“œí•œ urlì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.
  ì´ë•Œ urlë¡œ ì´ë™í•˜ë©´ ì´ëŸ¬í•œ ì´ìƒí•œ í™”ë©´ì´ ë‚˜ì™”ë‹¤.
- ì‹¤ì œë¡œ ë¸Œë¼ìš°ì €ì— í•´ë‹¹ urlì„ ê²€ìƒ‰í•˜ë©´ ì´ ë•Œë„ ì‚¬ì§„ì´ ë³´ì´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, ë°”ë¡œ ë‹¤ìš´ë¡œë“œê°€ ë˜ì–´ë²„ë ¸ë‹¤.

  ![img_6.png](img_6.png)

---
- í™•ì¸í•´ë³´ë‹ˆ ì—…ë¡œë“œ ì‹œ Content-Typeì´ multipart/form-dataë¡œ ì„¤ì •ì´ ë˜ì–´ë²„ë ¤ ìë™ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ íŒŒì¼ë¡œ ì¸ì‹í•œë‹¤ëŠ” ì ì´ì—ˆë‹¤.
- ê·¸ë˜ì„œ ë‹¤ì‹œ Content-Typeì„ ì„¤ì •í•˜ì§€ ì•Šê³  ì—…ë¡œë“œí–ˆë”ë‹ˆ ìë™ìœ¼ë¡œ png íƒ€ì…ìœ¼ë¡œ ì„¤ì •ì´ ë˜ë©´ì„œ í•´ë‹¹ í”„ë¡œí•„ ì‚¬ì§„ì„ ì¡°íšŒí•  ìˆ˜ ìˆì—ˆë‹¤.
  ![img_7.png](img_7.png)

</div>
</details>


<details>
<summary><strong>8. ì´ë¯¸ì§€ ì—…ë¡œë“œ : ì—¬ëŸ¬ ì¥ ì—…ë¡œë“œ êµ¬í˜„ì— ëŒ€í•œ ê³ ë¯¼</strong></summary>

<div markdown="1"> 
- ì´ë¯¸ì§€ ì—…ë¡œë“œë¥¼ í•  ë•Œ í”„ë¡œí•„ì‚¬ì§„ì€ í•œì¥ë§Œ ì—…ë¡œë“œë¥¼ í•˜ì—¬, ì´ë¥¼ ë‹¤ë¥¸ ì‚¬ì§„ìœ¼ë¡œ êµì²´í•  ë•Œì—ëŠ” ì›ë˜ ì—…ë¡œë“œë˜ì—ˆë˜ ì‚¬ì§„íŒŒì¼ì„ S3ì—ì„œ ì‚­ì œ í›„ ë‹¤ì‹œ ì˜¬ë¦¬ê¸° ê¸°ëŠ¥ì„ ë§Œë“¤ ìˆ˜ ìˆì—ˆë‹¤. ì–´ë–»ê²Œë“ ...

```java
@Transactional
public String uploadProfileImage(String accountId, List<MultipartFile> multipartFile) {
    // ë³¸ì¸ì¸ì§€ í™•ì¸
    manager.checkIdIsEqual(accountId);
    // í•´ë‹¹ ìœ ì € ì—”í‹°í‹°ì˜ profileì´ nullì´ ì•„ë‹ˆë©´ í•´ë‹¹ íŒŒì¼ì„ ì‚­ì œí•˜ê³ , ìƒˆë¡œìš´ í”„ë¡œí•„ ì‚¬ì§„ì„ ì—…ë¡œë“œ í•  ê²ƒ.

    // 1. í•´ë‹¹ ìœ ì € ì—”í‹°í‹° ê°–ê³ ì˜¤ê¸°
    UserEntity foundUser = optional.getFoundUser(accountId);
    // 2. profileì´ nullì¸ì§€ í™•ì¸
    if (foundUser.getProfile() != null) {
        // nullì´ ì•„ë‹ˆë©´ í•´ë‹¹ urlì— ìˆëŠ” ì‚¬ì§„ê°ì²´ë¥¼ ì‚­ì œí•  ê²ƒ
        s3FileService.deleteImage("/profile", foundUser.getProfile()
                .substring(foundUser.getProfile().lastIndexOf("/")+1,
                        foundUser.getProfile().length()-1));
    }

    // s3ì— í•´ë‹¹ í”„ë¡œí•„ ì‚¬ì§„ ì—…ë¡œë“œ (ë‹¨ í•œì¥ë§Œ ê°€ëŠ¥!!)
    if (multipartFile.size() > 1) {
        throw new ResponseStatusException(HttpStatus.BAD_REQUEST, "í”„ë¡œí•„ ì‚¬ì§„ì€ í•œì¥ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥");
    }
    List<String> uploadUrls =  s3FileService.uploadIntoS3("/profile", multipartFile);
    log.info("uploadUrl  "+uploadUrls.toString());

    foundUser.setProfile(uploadUrls.toString());
    userRepository.save(foundUser);
    return foundUser.getProfile();
}
```

- ì½”ë“œë¥¼ ì“°ë©´ì„œë„ ì•„ë‹ˆë‹¤ ì‹¶ì€ ì½”ë“œê°€ ë˜ì–´ê°”ë‹¤.
- ê·¸ë‹ˆê¹Œ String í˜•íƒœì˜ Profileì„ substringí•˜ëŠ”ë°..
- ë˜ Listí˜•íƒœë¥¼ toStringìœ¼ë¡œ ì €ì¥í•œ ê²ƒì´ê¸° ë•Œë¬¸ì— ì• ë’¤ì— [example.jpg] ì´ë ‡ê²Œ ì¤‘ê´„í˜¸ê¹Œì§€ ê°™ì´ ì €ì¥ì´ ëœë‹¤.
  ë¬¼ë¡  í”„ë¡œí•„ ì‚¬ì§„ì€ í•œì¥ë§Œ ì˜¬ë¦¬ê¸° ë•Œë¬¸ì— ì–´ë–»ê²Œë“  í•´ê²° í•  ìˆ˜ ìˆì§€ë§Œ,
  ì¤‘ê³ ë¬¼í’ˆê³¼ ì‡¼í•‘ëª° ì œí’ˆ ì‚¬ì§„ê°™ì€ ê²½ìš°ì—ëŠ” ë¬´ì¡°ê±´ **ì—¬ëŸ¬ ì¥**ì„ ì˜¬ë ¤ì•¼ í•  ê²ƒ!!

- ê·¸ë ‡ê²Œ ë˜ë©´ Item -> ItemImage ì´ë ‡ê²Œ **1: N ê´€ê³„**ë¡œ ìƒˆë¡œ ì—”í‹°í‹°ë¥¼ ë§Œë“¤ì–´ì•¼ í•¨ì„ ê¹¨ë‹¬ì•˜ë‹¤.
- ì¤‘ê³ ë¬¼í’ˆ UsedGoods -> UsedGoodsImage ì´ê²ƒë„ ë˜‘ê°™ì´ **1:N ê´€ê³„**ì˜ ì—”í‹°í‹°ê°€ í•„ìš”í•˜ë‹¤.
---
ê·¸ë˜ì„œ ìƒˆë¡­ê²Œ ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ì—¬ í•´ê²°!
![img_8.png](img_8.png)
![img_9.png](img_9.png)

</div>
</details>


<details>
<summary><strong>9. Listë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ë°œìƒí•˜ëŠ” NullPointerException </strong></summary>

<div markdown="1"> 

: ì´ë¯¸ì§€ ì—”í‹°í‹°ë¥¼ ë§Œë“¤ì–´ì£¼ì—ˆê³ , í•´ë‹¹ ì¤‘ê³ ë¬¼í’ˆì— ëŒ€í•œ ì •ë³´ë¥¼ ë³´ì—¬ì¤„ ë•Œ ì˜¬ë¼ì˜¨ ìƒí’ˆ ì´ë¯¸ì§€ ë§í¬ë“¤ì´ í•¨ê»˜ ë³´ì´ê¸¸ ì›í–ˆë‹¤.

#### 1) NPE.
- ê·¸ëŸ°ë°, fromEntity()ë¼ëŠ” ì—”í‹°í‹°ë¥¼ DTOí˜•ì‹ìœ¼ë¡œ ë°”ê¿”ì£¼ëŠ” static factory methodë¥¼ ì‹¤í–‰í•˜ë©´ì„œ ì—”í‹°í‹° ìì²´ì— listê°€ nullì´ë¼ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. (ã… ã… )
  ![img_10.png](img_10.png)

- ë‚˜ì˜ ìƒê°ì˜ ì˜¤ë¥˜ ì²«ë²ˆì§¸ëŠ”
  UsedGoodsì— **ImageListë¥¼ ë¹Œë“œí•˜ì§€ ì•Šì•˜ë‹¤**.
- ì´ìœ ëŠ” Imageê°ì²´ë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ëŠ”ë° ì•„ì§ ì•ˆë§Œë“¤ì—ˆê¸° ë•Œë¬¸!! Imageê°ì²´ë“¤ì„ ë§Œë“¤ê³  ë‚˜ì„œ, ì–´ë–»ê²Œ í•˜ë©´ ë˜ì§€ ì•Šë‚˜?ë¼ê³  ìƒê°í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì´ê²ƒì´ ì˜¤ë¥˜ì˜ ì¶œë°œì ì´ì—ˆë‹¤.

```java
// ì¤‘ê³ ë¬¼í’ˆ ì—…ë¡œë“œ
public UsedGoodsDto uploadUsedGoods(List<MultipartFile> multipartFile, UsedGoodsDto dto) {
    // 1. ì…€ëŸ¬ ì •ë³´ ì¸ì¦ì •ë³´ì—ì„œ ê°€ì ¸ì˜¤ê¸°
    UserEntity seller = manager.loadUserFromAuth();

    // 2. sellerì •ë³´ì™€ dtoë¥¼ ê°€ì§€ê³ ì™€ì„œ ìƒˆë¡œìš´ UsedGoods ê°ì²´ ìƒì„±
    UsedGoods newGoods = UsedGoods.builder()
            .title(dto.getTitle())
            .description(dto.getDescription())
            .minimumPrice(dto.getMinimumPrice())
            .saleStatus(SaleStatus.ON_SALE)
            .seller(seller) // íŒë§¤ìëŠ” ì €ì¥ì€ í•˜ì§€ë§Œ, ì‹¤ì œë¡œ ì¡°íšŒì‹œì—ëŠ” ë³´ì´ì§€ ì•Šì•„ì•¼í•œë‹¤.
            .build();
    newGoods = usedGoodsRepo.save(newGoods);

    // 3. S3ì— ì´ë¯¸ì§€ë“¤ì„ ì—…ë¡œë“œí•˜ê³ , ê·¸ íŒŒì¼ë“¤ì´ ì €ì¥ëœ urlì„ Stringìœ¼ë¡œ ë°˜í™˜
    List<String> urls = s3FileService.uploadIntoS3("/usedgoods", multipartFile);
    // 4. ì´ String List í•˜ë‚˜í•˜ë‚˜ UsedGoodsImage ì—”í‹°í‹°ê°€ ê°ê° ìƒê¸´ë‹¤.
    for (String url : urls) {
        UsedGoodsImage image = UsedGoodsImage.builder()
                .imgUrl(url)
                .build();
        imageRepo.save(image);
    }
    return UsedGoodsDto.fromEntity(newGoods);
}
```
---
- ë¹Œë“œí•  ë•Œ ìƒì„±ì´ ë˜ëŠ”ë°,
  í•„ë“œì—ì„œ = new ArrayList<>(); ë¥¼ ì™¸ì³ë´ë„...ì•„ë¬´ì¼ ì—†ë‹¤..
- ë¹Œë”íŒ¨í„´ìœ¼ë¡œ **ìƒì„±í•  ë•Œ!** ê¼­ ì´ê±´ nullì´ ì•„ë‹ˆì•¼!! ë¼ê³  ì´ì•¼ê¸°ë¥¼ í•´ì£¼ì–´ì•¼ í•œë‹¤.

ì¼ë‹¨ ì´ê²ƒì´ í•µì‹¬!
```java
    // ì¤‘ê³ ë¬¼í’ˆ ì—…ë¡œë“œ
    public UsedGoodsDto uploadUsedGoods(List<MultipartFile> multipartFile, UsedGoodsDto dto) {
        // 1. ì…€ëŸ¬ ì •ë³´ ì¸ì¦ì •ë³´ì—ì„œ ê°€ì ¸ì˜¤ê¸°
        UserEntity seller = manager.loadUserFromAuth();

        // 2. sellerì •ë³´ì™€ dtoë¥¼ ê°€ì§€ê³ ì™€ì„œ ìƒˆë¡œìš´ UsedGoods ê°ì²´ ìƒì„±
        UsedGoods newGoods = UsedGoods.builder()
                .title(dto.getTitle())
                .description(dto.getDescription())
                .minimumPrice(dto.getMinimumPrice())
                .imageList(new ArrayList<>())
                .suggestionList(new ArrayList<>())
                .saleStatus(SaleStatus.ON_SALE)
                .seller(seller) // íŒë§¤ìëŠ” ì €ì¥ì€ í•˜ì§€ë§Œ, ì‹¤ì œë¡œ ì¡°íšŒì‹œì—ëŠ” ë³´ì´ì§€ ì•Šì•„ì•¼í•œë‹¤.
                .build();
        newGoods = usedGoodsRepo.save(newGoods);

        // 3. S3ì— ì´ë¯¸ì§€ë“¤ì„ ì—…ë¡œë“œí•˜ê³ , ê·¸ íŒŒì¼ë“¤ì´ ì €ì¥ëœ urlì„ Stringìœ¼ë¡œ ë°˜í™˜
        List<String> urls = s3FileService.uploadIntoS3("/usedgoods", multipartFile);
        // 4. ì´ String List í•˜ë‚˜í•˜ë‚˜ UsedGoodsImage ì—”í‹°í‹°ê°€ ê°ê° ìƒê¸´ë‹¤.
        for (String url : urls) {
            UsedGoodsImage image = UsedGoodsImage.builder()
                    .imgUrl(url)
                    .build();
            imageRepo.save(image);
        }
        return UsedGoodsDto.fromEntity(newGoods);
    }
```

![img_11.png](img_11.png)
- ìš”ë ‡ê²Œ ì˜¤ë¥˜ê°€ ìƒê¸°ì§€ ì•Šê³  ë‚˜ì™”ë‹¤! í•˜ì§€ë§Œ, ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ í–ˆìœ¼ë‚˜, ì´ë¯¸ì§€ urlListëŠ” ê²°ê³¼ê°’ìœ¼ë¡œ ë‚˜ì˜¤ì§€ ì•Šì•˜ë‹¤.

#### 2) ë‘ë²ˆì§¸ ì˜¤ë¥˜ : NPEëŠ” í•´ê²°ë˜ì—ˆìœ¼ë‚˜, Listê°€ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤

UsedGoods - UsedGoodsImage (N:1)ì˜ ê´€ê³„ë¡œ
ì–‘ë°©í–¥ ë§µí•‘ì„ í•´ì£¼ì—ˆë‹¤.
@OneToMany - @ManyToOne


- ë‚˜ì˜ ë‘ë²ˆì§¸ ìƒê°ì˜ ì˜¤ë¥˜ëŠ”
  UsedGoodsImageì—ì„œ ë¹Œë“œí• ë•Œ imgUrlê³¼ usedGoodsê°ì²´ë¥¼ í™œìš©í•´ ë¹Œë“œíŒ¨í„´ìœ¼ë¡œ ìƒì„±í•´ì£¼ë©´?
  ì¦‰ì‹œ ì´ ë‘˜ì˜ ê´€ê³„ê°€ ìƒê²¨ UsedGoodsì—ëŠ” ImageList urlì„ ì…ë ¥í•´ì¤„ í•„ìš”ê°€ ì—†ì„ ê±°ë¼ê³  ìƒê°í•œ ê²ƒ.

- ê·¸ëŸ¬ë‚˜, ì´ë ‡ê²Œ ë˜ë©´ imageìª½ì—ì„œë§Œ UsedGoodsê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ê°€ ìˆë‹¤.

- ê·¼ë° ë‚´ê°€ UsedGoodsDtoì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ”ê²ƒì€ ë°˜ëŒ€ë‹¤. UsedGoodsì—ì„œ **imageUrlListë¥¼** ê°€ì ¸ì˜¤ëŠ”ê²ƒ!

- ê·¸ëŸ¬ë¯€ë¡œ,,, ì–´ëŠ í•œìª½ì˜ ì—”í‹°í‹° ê°ì²´ë¥¼ ë„£ì„ë•Œ ë‘ ìª½ì—ë‹¤ê°€ ì €ì¥ì„ í•´ì£¼ëŠ” ê²ƒì´ë‹¤. ì´ê²Œ ë°”ë¡œ **ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ!!!**!
  ë” ìì£¼ ì“°ëŠ” ìª½ì—ë‹¤ ë§Œë“¤ì–´ì£¼ë©´ ëœë‹¤
- ë‚˜ëŠ” imageì—ë‹¤ ë„£ì–´ì£¼ì—ˆë‹¤.

```java
package com.example.missiontshoppingmall.usedGoods.entity;

import com.example.missiontshoppingmall.BaseEntity;
import jakarta.persistence.CascadeType;
import jakarta.persistence.Entity;
import jakarta.persistence.FetchType;
import jakarta.persistence.ManyToOne;
import lombok.*;

@Entity
@Getter
@AllArgsConstructor
@Builder
@NoArgsConstructor
public class UsedGoodsImage extends BaseEntity {
    @Setter
    private String imgUrl;

    @ManyToOne
    @Setter
    private UsedGoods usedGoods;

    // ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œ
    public void addUsedGoods(UsedGoods ug) {
        this.setUsedGoods(ug);
        ug.getImageList().add(this);
    }
}
```

---
- ì´ë¯¸ì§€ë¥¼ ë„£ì–´ì£¼ë©´ì„œ UsedGoods ê°ì²´ë¥¼ ì¸ìë¡œ í•´ì„œ setí•´ì£¼ëŠ” ê²ƒ. ê·¸ë¦¬ê³ , UsedGoods ê°ì²´ ì…ì¥ì—ì„œë„ ë™ì¼í•˜ê²Œ ImageList()ì—ë‹¤ í•´ë‹¹ Image ê°ì²´ë¥¼ ì¶”ê°€í•´ì£¼ëŠ” ê²ƒ.
```java
    // ì¤‘ê³ ë¬¼í’ˆ ì—…ë¡œë“œ
    public UsedGoodsDto uploadUsedGoods(List<MultipartFile> multipartFile, UsedGoodsDto dto) {
        // 1. ì…€ëŸ¬ ì •ë³´ ì¸ì¦ì •ë³´ì—ì„œ ê°€ì ¸ì˜¤ê¸°
        UserEntity seller = manager.loadUserFromAuth();

        // 2. sellerì •ë³´ì™€ dtoë¥¼ ê°€ì§€ê³ ì™€ì„œ ìƒˆë¡œìš´ UsedGoods ê°ì²´ ìƒì„±
        UsedGoods newGoods = UsedGoods.builder()
                .title(dto.getTitle())
                .description(dto.getDescription())
                .minimumPrice(dto.getMinimumPrice())
                .imageList(new ArrayList<>())
                .saleStatus(SaleStatus.ON_SALE)
                .seller(seller) // íŒë§¤ìëŠ” ì €ì¥ì€ í•˜ì§€ë§Œ, ì‹¤ì œë¡œ ì¡°íšŒì‹œì—ëŠ” ë³´ì´ì§€ ì•Šì•„ì•¼í•œë‹¤.
                .build();
        newGoods = usedGoodsRepo.save(newGoods);

        // 3. S3ì— ì´ë¯¸ì§€ë“¤ì„ ì—…ë¡œë“œí•˜ê³ , ê·¸ íŒŒì¼ë“¤ì´ ì €ì¥ëœ urlì„ Stringìœ¼ë¡œ ë°˜í™˜
        List<String> urls = s3FileService.uploadIntoS3("/usedgoods", multipartFile);
        // 4. ì´ String List í•˜ë‚˜í•˜ë‚˜ UsedGoodsImage ì—”í‹°í‹°ê°€ ê°ê° ìƒê¸´ë‹¤.
        for (String url : urls) {
            UsedGoodsImage image = UsedGoodsImage.builder()
                    .imgUrl(url)
                    .build();
            // ì—¬ê¸°ì„œ ì—°ê´€ê´€ê³„ ë©”ì„œë“œ (ì´ë¯¸ì§€ì— UsedGoods setí•˜ëŠ” ë™ì‹œì— UsedGoodsì˜ imageListì— ì¶”ê°€í•´ì£¼ê¸°)
            image.addUsedGoods(newGoods);
            imageRepo.save(image);
        }

        return UsedGoodsDto.fromEntity(newGoods);
    }
```
![img_12.png](img_12.png)
ê·¸ë¬ë”ë‹ˆ imgUrlë„ ëª¨ë‘ ë‚˜ì™”ë‹¤!

</div>
</details>


<details>
<summary><strong>10. í† ìŠ¤ í˜ì´ë¨¼ì¸ ì—ì„œ í”„ë¡ íŠ¸ì™€ ë°±ì„ ë„˜ë‚˜ë“¤ê¸°</strong></summary>

<div markdown="1"> 

- ì²˜ìŒì—ëŠ” ì•„ì˜ˆ ë°©í–¥ì„ ëª»ì¡ì•˜ë‹¤. ì—¬íƒœ ê³„ì† í¬ìŠ¤íŠ¸ë§¨ìœ¼ë¡œë§Œ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë‹¤ë³´ë‹ˆ, í† ìŠ¤ ê²°ì œëŠ” ì‹¤ì œë¡œ html ì°½ì´ ìˆì–´ì•¼ í…ŒìŠ¤íŠ¸ë¥¼ í•  ìˆ˜ ìˆëŠ”ë°, ì´ë•Œ ê·¸ëŸ¬ë©´ JSON í˜•íƒœë¡œ ì£¼ê³ ë°›ê³  í•˜ëŠ” ë°©ë²•ì„ ì•„ì˜ˆ ëª°ë¼ì„œ ê³„ì† í—¤ë§¸ë‹¤.

#### ë‚´ê°€ êµ¬í˜„í•œ ë°©ë²•

1) RestControllerê°€ ì•„ë‹Œ ê·¸ëƒ¥ Controllerë¡œ htmlì— ëŒ€í•œ ì„¤ì •ì„ í•´ì¤€ë‹¤. ê·¸ htmlì°½ì—ì„œ ê²°ì œë¥¼ í•˜ëŠ” ê²ƒ!



2) ê²°ì œë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ì„œ ë‚˜ëŠ” orderIdë¥¼ pathVariableë¡œ ë„£ì–´ì£¼ì—ˆë‹¤. -> /payment/{orderId}ë¡œ ì´ë™í•´ì•¼ í•¨.
- ì–´ì°¨í”¼ ì£¼ë¬¸í•˜ë©´ ê·¸ ì •ë³´ì— orderIdê°€ ë‚˜ì™€ìˆê¸° ë•Œë¬¸ì— ê·¸ê±¸ ì´ìš©í•´ì„œ ë¸Œë¼ìš°ì €ì—ì„œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•˜ë‹¤.
- ê·¸ë¦¬ê³ , ì—¬ê¸°ì„œ redirectAttributesë¡œ orderId, orderItemName, amountë¥¼ ë„˜ê²¨ì£¼ì—ˆë‹¤.
```java
@Controller
@Slf4j
@RequiredArgsConstructor
public class PaymentController {
    private final EntityFromOptional optional;

    // ê²°ì œìš”ì²­ htmlë¡œ ì´ë™í•˜ëŠ”
    @GetMapping("/payment/{orderId}")
    public String requestPayment(
            @PathVariable("orderId") Long orderId,
            RedirectAttributes redirectAttributes
    ) {
        // redirectAttributesë¡œ orderì— ëŒ€í•œ ì •ë³´ í•¨ê»˜ ì „ë‹¬.
        ItemOrder foundOrder = optional.gerOrder(orderId);
        // ë§Œì•½ not paidìƒíƒœê°€ ì•„ë‹ˆë©´ ì˜ˆì™¸ì²˜ë¦¬
        if (!foundOrder.getPaymentStatus().equals(PaymentStatus.NOT_PAID)) {
            log.info("ì§€ë¶ˆì´ ë¶ˆê°€ëŠ¥í•œ ì£¼ë¬¸ì…ë‹ˆë‹¤.");
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST);
        }
        redirectAttributes.addAttribute("orderItem", foundOrder.getOrderItem().getName());
        redirectAttributes.addAttribute("amount", foundOrder.getTotalPrice());
        redirectAttributes.addAttribute("orderId", orderId);
        return "redirect:/static/payment.html";
    }
}
```
3) ë¸Œë¼ìš°ì €ì—ì„œ ê²°ì œí•˜ê¸° ëˆ„ë¥´ê³  ì‚¬ìš©ìê°€ ê²°ì œë¥¼ í•˜ë©´ ì—¬ê¸°ì„œ ê²°ì œ ìš”ì²­ì„ ê°€ëŠ”ë°, ì—¬ê¸°ì„œ
- ê²°ì œ ìš”ì²­í•  ë•Œ orderNameì—ë‹¤ê°€ ë„˜ê²¨ì„œ.... ë„£ì–´ì£¼ì—ˆë‹¤.
```html
<script>
// ë§Œì•½ Bearer Tokenë§Œìœ¼ë¡œ ì¸ì¦ì„ í•˜ê²Œë˜ë©´ ê²°ì œí•˜ë ¤ëŠ” ìƒí’ˆì´ ì—¬ëŸ¬ê°œì¼ ê²½ìš°ì—ëŠ” êµ¬ë¶„í•˜ê¸° ì–´ë ¤ìš¸ ê²ƒ
// ê°™ë‹¤ê³  ìƒê°í–ˆë‹¤. ê·¸ë˜ì„œ ê·¸ëƒ¥ urlë¡œ orderId ìì²´ë¥¼ ë„˜ê²¨ì„œ í•´ê²°í•˜ë ¤ê³  í–ˆë‹¤.
// todo: ê³ ë¯¼ì¸ ê²ƒì€ orderId, amount, orderItemì´ urlë¡œ ë…¸ì¶œë˜ì–´ë„ ê´œì°®ì„ê¹Œ?
// í˜„ì¬ ë‚´ ê´€ë…ì—ì„œëŠ” ê´œì°®ì„ ê²ƒ ê°™ì•„ì„œ ì‚¬ìš©í•˜ì˜€ë‹¤.

    // urlì—ì„œ ê°’ì„ ì–»ì–´ì„œ ë³€ìˆ˜ë¡œ ì§€ì •
    const urlParams = new URLSearchParams(window.location.search);
    const itemOrderId = urlParams.get('orderId');
    const amount = urlParams.get('amount');
    const orderItem = urlParams.get('orderItem');

    // êµ¬ë§¤ìì˜ ê³ ìœ  ì•„ì´ë””ë¥¼ ë¶ˆëŸ¬ì™€ customerKeyë¡œ ì„¤ì •
    const clientKey = '  '

    // ê²°ì œ ìœ„ì ¯, ê²°ì œ ë°©ë²• ìœ„ì ¯
    const paymentWidget = PaymentWidget(clientKey, PaymentWidget.ANONYMOUS)
    const paymentMethodsWidget = paymentWidget.renderPaymentMethods(
        '#payment-method',
        {
            value: 0,
            currency: 'KRW',
            country: 'KR',
        },
        { variantKey: 'widgetA'}
    )
    //ê²°ì œ ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜
    const paymentAgreement = paymentWidget.renderAgreement(
        '#agreement',
        { variantKey: 'AGREEMENT' }
    )

    //ì—¬ê¸°ì„œ ì‹¤ì œ ê²°ì œ ê°€ê²©ìœ¼ë¡œ update!!
    paymentMethodsWidget.updateAmount(amount);
    
    // ê²°ì œ ìš”ì²­
    const paymentRequestButton = document.getElementById('payment-request-button');
    paymentRequestButton.addEventListener('click', () => {
        try {
            paymentWidget.requestPayment({
                orderId: crypto.randomUUID().replaceAll('-', ''), // orderIdëŠ” ì´ê±°ê³ ìš”,,
                orderName: `${itemOrderId}-${orderItem}`, // orderNameì€ ì´ê±¸ë¡œ ì •í•´ì¤Œ.
            }).then(async data => {
                const response = await fetch('/shopping-malls/order/{orderId}/payment', {
                    method: 'post',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        paymentKey: data.paymentKey,
                        orderId: data.orderId,
                        amount: data.amount,
                    }),
                })
                if (response.ok) {
                    console.log(data.paymentKey);
                    location.pathname = '/static/success.html'
                }
            });
        } catch (err) {
            if (err.code == 'USER_CANCEL') {
                alert('ì‚¬ìš©ì ê²°ì œ ì·¨ì†Œ')
            }
            else alert(err);
        }
    });
```

4) ì´í›„ TossController toss/confirm-paymentì—ì„œ ì­ˆë£¨ë£© ì§„í–‰ëœ ê²ƒë“¤ì´ ë‹¤ì‹œ ì„œë¹„ìŠ¤ë‹¨ìœ¼ë¡œ ëŒì•„ì™€, ê²°ì œ ìŠ¹ì¸ ìš”ì²­ì‹œ serviceë‹¨ì—ì„œ ìƒí’ˆ ì¬ê³ ê°€ ê°±ì‹ ë˜ê³ , paymentKeyë¥¼ ì €ì¥í•´ì£¼ê³ , ê²°ì œìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ í•´ì£¼ì—ˆë‹¤.

```java
// OrderService class
	// ê²°ì œ ìŠ¹ì¸ ìš”ì²­ ë³´ë‚´ê¸°
    public OrderResponse confirmPayment(PaymentConfirmDto dto) {
        // HTTP ìš”ì²­ ë³´ëƒ„
        HashMap<String, Object> tossPaymentObj = tossService.confirmPayment(dto);
        log.info("tossPaymentObj :: " + tossPaymentObj.toString());

        String itemOrderId = tossPaymentObj.get("orderName").toString().split("-")[0];
        // orderIdë¡œ Order ê°ì²´ ì°¾ì•„ë‚´ê¸°
        ItemOrder foundOrder = optional.gerOrder(Long.parseLong(itemOrderId));
        // ê²°ì œ ì„±ê³µì‹œ ì¬ê³ ê°€ ê°±ì‹ ë˜ì–´ì•¼ í•œë‹¤.
        Integer stockNow = foundOrder.getOrderItem().getStock(); // í˜„ì¬ì¬ê³ 
        foundOrder.getOrderItem().setStock(stockNow-foundOrder.getAmount()); // ì¬ê³  ê°±ì‹ .
        foundOrder.setPaymentStatus(PaymentStatus.PAID);
        foundOrder.setPaymentKey(tossPaymentObj.get("paymentKey").toString()); // ì•„ì§ì€ transactionì™„ë£Œê°€ ì•„ë‹˜.

        foundOrder = orderRepo.save(foundOrder);
        return OrderResponse.fromEntity(foundOrder);
    }
```

![img_13.png](img_13.png)

ì´ë ‡ê²Œ paymentKeyê°€ ì €ì¥ë˜ë©´ì„œ í•´ê²° ì™„ë£Œ!!~~
</div>
</details>